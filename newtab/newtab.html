<html>
 <head>
  <title>LaunchTab</title>
  <script src="data.js"></script>
  <style>
  
  	body {
  		font-family:Calibri;
  		font-size:1.2em; 
  	
  	}
  	
  	
  	a {
  		color: black;
  		text-decoration:none;
  	}
  	
  	a:HOVER {
  		color: blue;
  		text-decoration:underline;
  		
  	}
  	
  
  	
  	.linkHeader {
  		font-weight: bold;
  		color: white;
  		background-color: gray;
  		font-size: 1.1em;
  		padding: 2px;
  		border-color: black;
  		border-style: solid;
		border-width: 1px;
  		
  	}
  	
  	li {
  		color: gray;
  	}
  
  	
  </style>
  
  
  	<script type="text/javascript">
  	
  	 function getLocation(href) {
  	    var l = document.createElement("a");
  	    l.href = href;
  	    return l
  	  }
  	  
  	  function contains(a, obj){
  		  for(var i = 0; i < a.length; i++) {
  		    if(a[i] === obj){
  		      return true;
  		    }
  		  }
  		  return false;
  		}
  	
  	

	function displayFavoriteLink(url){
		var ulFavoriteLinks = document.getElementById('ulFavoriteLinks');
		if (url != "" && url != null && url != "null") {
	 		var fav = document.createElement('li');
		 	fav.innerHTML = "<a href='" + url + "'>" + url + "</a>";
		  	ulFavoriteLinks.appendChild(fav);  		  
		}
	}





  	</script>

  
  
  
 </head>
 <body>
  
  <label class="linkHeader">Favorite Links</label> 
  <ul id="ulFavoriteLinks" >
  </ul>  
	
	
  <label class="linkHeader">Most Visited</label> 
    <ul id="ulMostVisited" >
  </ul>  
  
   <label class="linkHeader">Most Recent</label> 
    <ul id="ulMostRecent" >
  	</ul>  
	
	
	
 <script type="text/javascript">
  
 	//TODO: show/hide sections based on options
 	
 	//parse the last 30 days of history
 	var date = new Date();
	date.setDate(date.getDate() - 30);

 	chrome.history.search({text: "", maxResults: 1000, startTime: Number(date)}, function(items) {
  		
  		/**************************************
  		****** MOST RECENT ********************
  		**************************************/
  	 	var ulMostRecent = document.getElementById('ulMostRecent');
  	 	for (i = 0; i < 10; i++) {
  	 		var hostname = getLocation(items[i].url).hostname;
  	 		var link = document.createElement('li');
			link.innerHTML = "<a href='" + items[i].url + "'>" + hostname + "</a>&nbsp;&nbsp;<i>(" + items[i].title + ")</i>";
			ulMostRecent.appendChild(link);
  	 	}
  	 	
  		/**************************************
  		****** MOST VISITED *******************
  		**************************************/
  	 	// determine the most visited
  	 	var mostVisitedItems = items;
  	 	mostVisitedItems.sort(function(a, b){
  	 	 return b.visitCount - a.visitCount;
  	 	})
  	 	
  	 	// populate the most visited
  		var ulMostVisited = document.getElementById('ulMostVisited');
  	 	var alreadyUsedDomains = new Array();
  	 	var count = 0;
  	 	var index = 0;
  	 	while (index < mostVisitedItems.length && count <= 10) {
  	 		var tmpItem = mostVisitedItems[index];
  	 		var hostname = getLocation(tmpItem.url).hostname;
  	 		
  	 		
  	 		//there are  cases where are multiple "most visited" entries for the same domain; we only use the latest one.  
  	 		//an example of this being an issue is with gmail. if the user types in mail.google.com or gmail.com, they are redirected automatically to the https://mail.google.com/mail/#inbox.  
  	 		//in this situation we would erroneously get two "gmail" entries in the most visited list, which would pollute the results.
  	 		if (!contains(alreadyUsedDomains, hostname)) {	
				var link = document.createElement('li');
				link.innerHTML = "<a href='" + tmpItem.url + "'>" + hostname + "</a>&nbsp;&nbsp;<i>(" + tmpItem.title + ")</i>";
				ulMostVisited.appendChild(link);
				count++;
				alreadyUsedDomains.push(hostname);
			}
  	 		index++;
  	 	}  	 	
  	 		  	 	
  	});
  
  
  	/**************************************
	****** FAVORITES **********************
	**************************************/
	 	
  	//populate the favorites
 	var favoriteLinks = new Array();
  	favoriteLinks = getFavoriteLinks();
  	
  	for (index in favoriteLinks) {
  		displayFavoriteLink(favoriteLinks[index]);	
  	}
  	
  	
  
  
  </script>
 

	
	
 </body>
</html>

